<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Take Action &mdash; Write Your Representatives</title>
  <meta name="description" content="Write your representatives. Demand justice for the children in the Epstein files.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400&family=Playfair+Display:ital,wght@0,400;0,500;0,600;0,700;1,400;1,500&family=IM+Fell+English:ital@0;1&family=IM+Fell+DW+Pica:ital@0;1&display=swap" rel="stylesheet">
  <style>
    *,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
    :root{--void:#050403;--bone:#e8e2d4;--bone-dim:rgba(232,226,212,0.55);--gold:#c9a227;--gold-bright:#e6c656;--gold-dim:#8b7355;--gold-glow:rgba(201,162,39,0.25);--smoke:#666;--wood-dark:#1a140e}
    html{font-size:17px;scroll-behavior:smooth;-webkit-font-smoothing:antialiased}
    body{background:var(--void);color:var(--bone);font-family:'Cormorant Garamond',Georgia,serif;line-height:1.8;min-height:100vh}
    ::selection{background:var(--gold);color:var(--void)}
    a{color:var(--gold);text-decoration:none}a:hover{color:var(--gold-bright)}

    .page{max-width:700px;margin:0 auto;padding:3.5rem 2rem 5rem}

    /* Header */
    .hdr{text-align:center;margin-bottom:2.5rem;padding-bottom:2rem;border-bottom:1px solid rgba(201,162,39,0.15)}
    .hdr-orn{font-size:1.1rem;color:var(--gold-dim);letter-spacing:.6em;margin-bottom:1.2rem;opacity:.6}
    .hdr h1{font-family:'Playfair Display',Georgia,serif;font-size:2.2rem;font-weight:600;letter-spacing:.04em;line-height:1.2;margin-bottom:.5rem}
    .hdr p{font-family:'Cormorant Garamond',Georgia,serif;font-size:1rem;font-weight:300;font-style:italic;color:var(--gold)}

    /* Intro */
    .intro{margin-bottom:2.5rem}
    .intro p{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.92rem;color:var(--bone-dim);line-height:1.85;margin-bottom:.8rem}
    .intro strong{color:var(--bone);font-weight:600}
    .intro .em{color:var(--gold);font-style:italic}

    /* Form panels */
    .panel{background:linear-gradient(170deg,#1a140e 0%,#0d0a06 100%);border:1px solid rgba(201,162,39,0.12);padding:2rem 1.8rem;margin-bottom:1.2rem}
    .panel-title{font-family:'Playfair Display',Georgia,serif;font-size:1.05rem;font-weight:500;color:var(--gold);letter-spacing:.06em;text-transform:uppercase;margin-bottom:.3rem}
    .panel-desc{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.82rem;color:var(--bone-dim);font-style:italic;line-height:1.5;margin-bottom:1rem}
    .row{margin-bottom:.8rem}
    .row:last-child{margin-bottom:0}
    .lbl{display:block;font-family:'IBM Plex Mono','Courier New',monospace;font-size:.6rem;letter-spacing:.2em;text-transform:uppercase;color:var(--gold-dim);margin-bottom:.25rem}
    .inp,.sel,.ta{width:100%;padding:.65em .9em;background:rgba(0,0,0,.4);border:1px solid rgba(201,162,39,.2);color:var(--bone);font-family:'IM Fell DW Pica',Georgia,serif;font-size:.93rem;line-height:1.5;border-radius:0;outline:none;transition:border-color .3s;-webkit-appearance:none}
    .inp:focus,.sel:focus,.ta:focus{border-color:var(--gold)}
    .inp::placeholder,.ta::placeholder{color:var(--smoke);opacity:.5;font-style:italic}
    .sel option{background:var(--void);color:var(--bone)}
    .ta{min-height:60px;resize:vertical}
    .hint{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.75rem;color:var(--smoke);font-style:italic;margin-top:.2rem;line-height:1.4}
    .hint a{color:var(--gold);text-decoration:underline;text-underline-offset:2px}
    .cols{display:grid;grid-template-columns:1fr 1fr;gap:.8rem}

    /* Senator cards */
    .sen-list{display:flex;flex-direction:column;gap:.5rem;margin-top:.6rem}
    .sen{display:flex;align-items:center;gap:.7rem;padding:.7rem .9rem;border:1px solid rgba(201,162,39,.15);background:rgba(201,162,39,.03);cursor:pointer;transition:all .25s}
    .sen:hover{border-color:var(--gold-dim)}
    .sen.on{border-color:var(--gold);background:rgba(201,162,39,.07)}
    .sen input{width:16px;height:16px;accent-color:var(--gold);flex-shrink:0}
    .sen-info{flex:1;min-width:0}
    .sen-name{font-family:'Playfair Display',Georgia,serif;font-size:.92rem;font-weight:500}
    .sen-meta{font-family:'IBM Plex Mono','Courier New',monospace;font-size:.52rem;letter-spacing:.12em;text-transform:uppercase;color:var(--gold-dim);margin-top:.1rem}
    .sen-contact{font-family:'IBM Plex Mono','Courier New',monospace;font-size:.5rem;color:var(--gold-dim);text-decoration:none;flex-shrink:0;border:1px solid rgba(201,162,39,.2);padding:.25em .6em;transition:all .25s}
    .sen-contact:hover{border-color:var(--gold);color:var(--gold)}
    .no-state{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.88rem;color:var(--bone-dim);font-style:italic;padding:.8rem 0}
    .add-rep-row{margin-top:.8rem;display:flex;gap:.5rem;align-items:flex-end}
    .add-rep-row .inp{flex:1}
    .add-btn{padding:.65em 1em;background:transparent;border:1px solid var(--gold-dim);color:var(--gold);font-family:'IM Fell English',Georgia,serif;font-size:.78rem;cursor:pointer;transition:all .3s;white-space:nowrap;flex-shrink:0}
    .add-btn:hover{border-color:var(--gold);background:rgba(201,162,39,.06)}

    /* Custom textarea reveal */
    .cw{display:none;margin-top:.4rem}.cw.vis{display:block}

    /* Checkboxes */
    .chks{display:flex;flex-direction:column;gap:.6rem}
    .chk{display:flex;align-items:flex-start;gap:.5rem;cursor:pointer}
    .chk input{width:15px;height:15px;margin-top:3px;accent-color:var(--gold);flex-shrink:0}
    .chk span{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.88rem;line-height:1.5}
    .chk strong{color:var(--bone);font-weight:600}

    /* Delivery */
    .dopt{display:flex;align-items:flex-start;gap:.6rem;padding:.8rem;border:1px solid rgba(201,162,39,.1);background:rgba(0,0,0,.2);cursor:pointer;transition:all .25s;margin-bottom:.5rem}
    .dopt:hover{border-color:rgba(201,162,39,.3)}
    .dopt.on{border-color:var(--gold);background:rgba(201,162,39,.04)}
    .dopt input{width:15px;height:15px;margin-top:2px;accent-color:var(--gold);flex-shrink:0}
    .dopt-t{font-family:'Playfair Display',Georgia,serif;font-size:.9rem;font-weight:500;margin-bottom:.1rem}
    .dopt-d{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.78rem;color:var(--bone-dim);font-style:italic;line-height:1.4}
    .email-row{display:none;margin-top:.6rem}.email-row.vis{display:block}

    /* Generate */
    .gen-btn{display:block;width:100%;padding:1.1em;margin-top:1.5rem;background:transparent;border:2px solid var(--gold);color:var(--gold);font-family:'IM Fell English',Georgia,serif;font-size:1.15rem;letter-spacing:.06em;cursor:pointer;transition:all .4s}
    .gen-btn:hover{background:rgba(201,162,39,.08);box-shadow:0 0 30px rgba(201,162,39,.15);transform:translateY(-1px)}

    /* Output */
    .out{display:none;margin-top:2.5rem}.out.vis{display:block}
    .lt-hdr{display:flex;align-items:center;justify-content:space-between;margin-bottom:.4rem;flex-wrap:wrap;gap:.5rem}
    .lt-title{font-family:'Playfair Display',Georgia,serif;font-size:1.15rem;font-weight:500}
    .lt-acts{display:flex;gap:.4rem;flex-wrap:wrap}
    .lt-btn{padding:.35em .9em;background:transparent;border:1px solid rgba(201,162,39,.3);color:var(--gold);font-family:'IBM Plex Mono','Courier New',monospace;font-size:.55rem;letter-spacing:.1em;text-transform:uppercase;cursor:pointer;transition:all .3s}
    .lt-btn:hover{border-color:var(--gold);background:rgba(201,162,39,.08)}
    .lt-to{font-family:'IBM Plex Mono','Courier New',monospace;font-size:.55rem;letter-spacing:.12em;text-transform:uppercase;color:var(--gold-dim);margin-bottom:.5rem}
    .lt-body{background:#faf6ec;color:#1a1712;font-family:'IM Fell DW Pica',Georgia,serif;font-size:.9rem;line-height:1.8;padding:2.5rem 2rem;border:1px solid #d4c9a8;white-space:pre-wrap;max-height:55vh;overflow-y:auto;margin-bottom:1.2rem}
    .lt-guide{background:rgba(201,162,39,.03);border:1px solid rgba(201,162,39,.1);padding:1.2rem;margin-bottom:1.5rem}
    .lt-guide-t{font-family:'Playfair Display',Georgia,serif;font-size:.95rem;font-weight:500;color:var(--gold);margin-bottom:.6rem}
    .lt-guide-s{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.85rem;color:var(--bone);line-height:1.6;margin-bottom:.4rem;padding-left:1.4em;text-indent:-1.4em}
    .lt-guide-s strong{color:var(--gold)}
    .lt-guide a.gl{display:inline-block;margin-top:.6rem;font-family:'IBM Plex Mono','Courier New',monospace;font-size:.55rem;letter-spacing:.08em;color:var(--gold);border:1px solid rgba(201,162,39,.3);padding:.35em .7em;transition:all .3s}
    .lt-guide a.gl:hover{background:rgba(201,162,39,.08);border-color:var(--gold)}
    .lt-note{font-family:'IM Fell DW Pica',Georgia,serif;font-size:.85rem;color:var(--bone-dim);font-style:italic;text-align:center;line-height:1.7;margin-top:2rem}

    /* Footer */
    .ftr{text-align:center;margin-top:3rem;padding-top:2rem;border-top:1px solid rgba(201,162,39,.15)}
    .ftr-orn{font-size:.8rem;color:var(--gold-dim);letter-spacing:.4em;margin-bottom:1rem;opacity:.5}
    .ftr-nav{font-family:'IBM Plex Mono','Courier New',monospace;font-size:.55rem;letter-spacing:.1em}
    .ftr-nav a{color:var(--gold-dim);transition:color .3s}.ftr-nav a:hover{color:var(--gold)}
    .ftr-d{margin:0 .6em;color:var(--gold-dim);opacity:.4}

    /* Film grain */
    body::before{content:'';position:fixed;inset:0;z-index:9999;pointer-events:none;opacity:.03;background:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E");mix-blend-mode:overlay}

    @media(max-width:600px){
      html{font-size:15px}.page{padding:2rem 1.1rem 3.5rem}.hdr h1{font-size:1.7rem}.panel{padding:1.3rem 1.1rem}.cols{grid-template-columns:1fr}.lt-body{padding:1.5rem 1.2rem;font-size:.84rem}.lt-hdr{flex-direction:column;align-items:flex-start}.add-rep-row{flex-direction:column}
    }

    @media print{
      body{background:#fff;color:#000}body::before{display:none}
      .hdr,.intro,.panel,.gen-btn,.lt-hdr,.lt-to,.lt-guide,.lt-note,.ftr,.lt-acts,.email-row{display:none!important}
      .lt-body{border:none;padding:0;max-height:none;font-size:12pt;line-height:1.6}
      .out{display:block!important}
    }
  </style>
</head>
<body>
<div class="page">

  <header class="hdr">
    <div class="hdr-orn">&#10087; &#9753;</div>
    <h1>Help Us Bear This</h1>
    <p>You sat in the chair. Now stand up and act.</p>
  </header>

  <div class="intro">
    <p>You have just come from something heavy. If your hands are shaking, that is the right response.</p>
    <p class="em">You do not have to carry this alone. But you do have to do something with it.</p>
    <p>This tool writes letters to your elected representatives <strong>in your name, in your voice</strong>. Select your state, tell us what you feel, and click one button. We handle the rest &mdash; including <strong>printing and mailing at no charge</strong> if you need us to.</p>
  </div>

  <!-- ═══ PANEL 1: YOU ═══ -->
  <div class="panel">
    <div class="panel-title">You</div>
    <div class="panel-desc">Your name goes on the letter. Your address goes on the envelope.</div>
    <div class="cols">
      <div class="row"><label class="lbl" for="f-name">Full Name</label><input class="inp" id="f-name" placeholder="Your name"></div>
      <div class="row"><label class="lbl" for="f-addr">Mailing Address</label><input class="inp" id="f-addr" placeholder="123 Main St, Austin, TX 78701"></div>
    </div>
  </div>

  <!-- ═══ PANEL 2: YOUR REPRESENTATIVES ═══ -->
  <div class="panel">
    <div class="panel-title">Your Representatives</div>
    <div class="panel-desc">Select your state. Your U.S. senators appear instantly. Check the ones you want to write.</div>
    <div class="row">
      <label class="lbl" for="f-state">Your State</label>
      <select class="sel" id="f-state" onchange="onStateChange()">
        <option value="">Select your state...</option>
      </select>
    </div>
    <div id="sen-area">
      <div class="no-state" id="sen-placeholder">Select your state above to see your senators.</div>
      <div class="sen-list" id="sen-list" style="display:none"></div>
    </div>
    <div style="margin-top:1rem">
      <div class="panel-desc" style="margin-bottom:.4rem">U.S. House Representative &amp; others <span class="hint">(optional &mdash; <a href="https://www.house.gov/representatives/find-your-representative" target="_blank">look up your rep</a>)</span></div>
      <div id="extra-reps"></div>
      <div class="add-rep-row">
        <input class="inp" id="f-extra-name" placeholder="e.g. Rep. Lloyd Doggett">
        <button class="add-btn" onclick="addExtraRep()">+ Add</button>
      </div>
    </div>
  </div>

  <!-- ═══ PANEL 3: YOUR VOICE ═══ -->
  <div class="panel">
    <div class="panel-title">Your Voice</div>
    <div class="panel-desc">Choose from below or write your own. These words go into your letter.</div>

    <div class="row">
      <label class="lbl" for="f-exp">Personal Experience</label>
      <select class="sel" id="f-exp" onchange="togCw('f-exp','cw-exp')">
        <option value="">I prefer not to share, but I demand accountability.</option>
        <option value="s1">I am a survivor of sexual assault. I know what it means when the powerful are not held accountable, because I have lived inside that silence.</option>
        <option value="s2">I am a survivor of childhood sexual abuse. I was a child. I did not have a voice then. I have one now.</option>
        <option value="s3">Someone I love is a survivor of sexual assault. I have watched what it does to a human being when justice never comes.</option>
        <option value="s4">Someone I love survived childhood sexual abuse. I have held them while they wept for the child they were. I will not be silent.</option>
        <option value="s5">I am a parent. I read these files and I think of my own children. The thought that this machine operated openly, protected by the powerful, is unbearable.</option>
        <option value="s6">I am an ordinary citizen who has never experienced this personally, but I refuse to live in a country where children are disposable and the powerful are untouchable.</option>
        <option value="s7">I have seen corruption and impunity among the powerful firsthand. The Epstein files confirm what many already knew: the rules do not apply equally.</option>
        <option value="custom">Let me write my own...</option>
      </select>
      <div class="cw" id="cw-exp"><textarea class="ta" placeholder="In your own words..."></textarea></div>
    </div>

    <div class="row">
      <label class="lbl" for="f-feel">What You Feel Reading These Files</label>
      <select class="sel" id="f-feel" onchange="togCw('f-feel','cw-feel')">
        <option value="f1">I feel rage &mdash; a fury that settles in my chest and does not leave. It is not partisan. It is human.</option>
        <option value="f2">I feel grief &mdash; a weight I cannot put down. Grief for the children. Grief for the country I thought I lived in.</option>
        <option value="f3">I feel physically sick. My stomach turns when I read what was done to those children, and how many people knew.</option>
        <option value="f4">I feel cold &mdash; a dread that seeps into my bones. The slow recognition that the system worked exactly as designed.</option>
        <option value="f5">I feel betrayed. By both parties. By every institution that was supposed to protect the vulnerable.</option>
        <option value="f6">I feel all of it &mdash; rage, grief, nausea, and underneath it, a desperate need for justice.</option>
        <option value="f7">I wept. I sat and wept. Something in these files broke through to a part of me I protect, and it will not let me look away.</option>
        <option value="custom">Let me describe it myself...</option>
      </select>
      <div class="cw" id="cw-feel"><textarea class="ta" placeholder="Describe what you feel..."></textarea></div>
    </div>

    <div class="row">
      <label class="lbl" for="f-extra">Anything Else (optional)</label>
      <textarea class="ta" id="f-extra" placeholder="Your own words, if you have more to say."></textarea>
    </div>
  </div>

  <!-- ═══ PANEL 4: DEMANDS ═══ -->
  <div class="panel">
    <div class="panel-title">Your Demands</div>
    <div class="panel-desc">All pre-selected. Uncheck any you wish to remove.</div>
    <div class="chks">
      <label class="chk"><input type="checkbox" id="d-sol" checked><span><strong>Remove the statute of limitations</strong> for all crimes against children &mdash; retroactively and in perpetuity.</span></label>
      <label class="chk"><input type="checkbox" id="d-pro" checked><span><strong>Impeach and prosecute</strong> all individuals incriminated in the Epstein files, regardless of party, office, or wealth.</span></label>
      <label class="chk"><input type="checkbox" id="d-max" checked><span><strong>Public hearing on Capitol Hill</strong> with Ghislaine Maxwell under oath. She was convicted of trafficking minors. She knows the names.</span></label>
      <label class="chk"><input type="checkbox" id="d-rel" checked><span><strong>Release all Epstein files</strong> unredacted, with no further delays or selective batching.</span></label>
    </div>
  </div>

  <!-- ═══ PANEL 5: DELIVERY ═══ -->
  <div class="panel">
    <div class="panel-title">Delivery</div>
    <label class="dopt on" onclick="setDel('self')"><input type="radio" name="del" value="self" checked><div><div class="dopt-t">I will print and mail it myself</div><div class="dopt-d">Print it, sign it, stamp it, mail it.</div></div></label>
    <label class="dopt" onclick="setDel('us')"><input type="radio" name="del" value="us"><div><div class="dopt-t">Print and mail for me &mdash; no charge</div><div class="dopt-d">We print on quality stock and mail to every representative you selected.</div></div></label>
    <label class="dopt" onclick="setDel('email')"><input type="radio" name="del" value="email"><div><div class="dopt-t">I will email it to their office</div><div class="dopt-d">We show you exactly where to paste it, with one-click copy.</div></div></label>
    <div class="email-row" id="email-row">
      <label class="lbl" for="f-email">Your Email (for mail confirmation)</label>
      <input class="inp" id="f-email" type="email" placeholder="you@example.com">
    </div>
  </div>

  <button class="gen-btn" onclick="generate()">Generate Your Letters</button>

  <!-- ═══ OUTPUT ═══ -->
  <div class="out" id="output"></div>

  <footer class="ftr">
    <div class="ftr-orn">&#10087; &#9753;</div>
    <nav class="ftr-nav">
      <a href="../The_Chair/">The Chair</a><span class="ftr-d">&middot;</span>
      <a href="../The_Chair/the-waters-recede.html">The Waters Recede</a><span class="ftr-d">&middot;</span>
      <a href="https://jethomasphd.github.io/THE_COMPANION_DOSSIER" target="_blank">The Dossier</a><span class="ftr-d">&middot;</span>
      <a href="../The_Watchtower/">Watchtower</a><span class="ftr-d">&middot;</span>
      <a href="../The_Handbill/">Handbill</a>
    </nav>
  </footer>

</div>

<script src="reps-data.js"></script>
<script>
// ═══════════════════════════════════════════════════════════════
//  INIT
// ═══════════════════════════════════════════════════════════════

(function(){
  var sel = document.getElementById('f-state');
  var codes = Object.keys(STATE_NAMES).sort(function(a,b){return STATE_NAMES[a]<STATE_NAMES[b]?-1:1});
  codes.forEach(function(c){
    var o = document.createElement('option');
    o.value = c; o.textContent = STATE_NAMES[c];
    sel.appendChild(o);
  });
  setDel('self');
})();

// ═══════════════════════════════════════════════════════════════
//  STATE → SENATORS
// ═══════════════════════════════════════════════════════════════

function onStateChange(){
  var st = document.getElementById('f-state').value;
  var list = document.getElementById('sen-list');
  var ph = document.getElementById('sen-placeholder');
  list.innerHTML = '';
  if(!st || !SENATORS[st]){
    list.style.display='none'; ph.style.display='block'; return;
  }
  ph.style.display='none'; list.style.display='flex';
  SENATORS[st].forEach(function(s){
    var label = document.createElement('label');
    label.className = 'sen on';
    label.innerHTML =
      '<input type="checkbox" checked data-type="senator" data-name="'+esc(s.n)+'" data-web="'+s.w+'" onchange="togSen(this)">' +
      '<div class="sen-info">' +
        '<div class="sen-name">Sen. '+esc(s.n)+'</div>' +
        '<div class="sen-meta">U.S. Senator &middot; '+s.p+'</div>' +
      '</div>' +
      '<a class="sen-contact" href="https://www.'+s.w+'.senate.gov/contact" target="_blank" onclick="event.stopPropagation()">Contact</a>';
    list.appendChild(label);
  });
}

function togSen(cb){
  var card = cb.closest('.sen');
  card.classList.toggle('on', cb.checked);
}

// ═══════════════════════════════════════════════════════════════
//  EXTRA REPS (House, State)
// ═══════════════════════════════════════════════════════════════

function addExtraRep(){
  var inp = document.getElementById('f-extra-name');
  var name = inp.value.trim();
  if(!name) return;
  inp.value = '';

  var container = document.getElementById('extra-reps');
  var label = document.createElement('label');
  label.className = 'sen on';
  label.innerHTML =
    '<input type="checkbox" checked data-type="rep" data-name="'+esc(name)+'" onchange="togSen(this)">' +
    '<div class="sen-info"><div class="sen-name">'+esc(name)+'</div><div class="sen-meta">Representative</div></div>' +
    '<span class="sen-contact" style="cursor:pointer;color:var(--smoke)" onclick="event.stopPropagation();this.closest(\'.sen\').remove()">Remove</span>';
  container.appendChild(label);
}

// ═══════════════════════════════════════════════════════════════
//  DROPDOWN CUSTOM TEXT
// ═══════════════════════════════════════════════════════════════

function togCw(selId,cwId){
  var s=document.getElementById(selId), cw=document.getElementById(cwId);
  if(s.value==='custom'){cw.classList.add('vis');var t=cw.querySelector('textarea');if(t)t.focus()}
  else cw.classList.remove('vis');
}

function getSelText(selId,cwId){
  var s=document.getElementById(selId);
  if(s.value==='custom'){var t=document.getElementById(cwId).querySelector('textarea');return t?t.value.trim():''}
  if(!s.value) return '';
  return s.options[s.selectedIndex].text;
}

// ═══════════════════════════════════════════════════════════════
//  DELIVERY
// ═══════════════════════════════════════════════════════════════

function setDel(v){
  document.querySelectorAll('.dopt').forEach(function(d){d.classList.remove('on')});
  document.querySelectorAll('input[name="del"]').forEach(function(r){
    if(r.value===v){r.checked=true;r.closest('.dopt').classList.add('on')}
  });
  document.getElementById('email-row').classList.toggle('vis',v==='us');
}

// ═══════════════════════════════════════════════════════════════
//  GENERATE
// ═══════════════════════════════════════════════════════════════

function generate(){
  var name = document.getElementById('f-name').value.trim();
  var addr = document.getElementById('f-addr').value.trim();
  if(!name){alert('Please enter your name.');document.getElementById('f-name').focus();return}

  // Collect recipients
  var recs = [];
  document.querySelectorAll('#sen-list input:checked, #extra-reps input:checked').forEach(function(cb){
    var t = cb.getAttribute('data-type');
    var n = cb.getAttribute('data-name');
    var w = cb.getAttribute('data-web') || '';
    if(t==='senator'){
      recs.push({name:'The Honorable '+n, office:'U.S. Senator', address:'United States Senate, Washington, DC 20510', web:w, contact:w?'https://www.'+w+'.senate.gov/contact':''});
    } else {
      recs.push({name:'The Honorable '+n, office:'U.S. Representative', address:'U.S. House of Representatives, Washington, DC 20515', web:'', contact:''});
    }
  });
  if(!recs.length){alert('Please select at least one representative.');return}

  var exp = getSelText('f-exp','cw-exp');
  var feel = getSelText('f-feel','cw-feel');
  var extra = document.getElementById('f-extra').value.trim();
  var dS=document.getElementById('d-sol').checked;
  var dP=document.getElementById('d-pro').checked;
  var dM=document.getElementById('d-max').checked;
  var dR=document.getElementById('d-rel').checked;
  var del = document.querySelector('input[name="del"]:checked').value;
  var dateStr = new Date().toLocaleDateString('en-US',{year:'numeric',month:'long',day:'numeric'});

  // Parse city from address
  var city = addr;

  var out = document.getElementById('output');
  out.innerHTML = '';

  recs.forEach(function(r,i){
    var letter = buildLetter(name,city,addr,dateStr,r,exp,feel,extra,dS,dP,dM,dR);
    var block = document.createElement('div');
    block.style.marginBottom = '2.5rem';

    // Header + actions
    var h = '<div class="lt-hdr"><div class="lt-title">Letter '+(i+1)+' of '+recs.length+'</div>';
    h += '<div class="lt-acts">';
    h += '<button class="lt-btn" onclick="copyLt(this)">Copy</button>';
    if(r.contact) h += '<button class="lt-btn" onclick="copyAndOpen(this,\''+esc(r.contact)+'\')">Copy &amp; Open Contact Form</button>';
    h += '<button class="lt-btn" onclick="window.print()">Print</button>';
    h += '</div></div>';

    // To label
    h += '<div class="lt-to">To: '+esc(r.name)+' &mdash; '+esc(r.office)+'</div>';

    // Letter body
    h += '<div class="lt-body">'+esc(letter)+'</div>';

    // Guide (email mode or always for senators)
    if(del==='email' || r.contact){
      h += '<div class="lt-guide">';
      h += '<div class="lt-guide-t">Send This Letter</div>';
      h += '<div class="lt-guide-s"><strong>1.</strong> Click "Copy" (or "Copy & Open Contact Form") above.</div>';
      if(r.contact){
        h += '<div class="lt-guide-s"><strong>2.</strong> Paste the letter into the message field on their contact page.</div>';
        h += '<div class="lt-guide-s"><strong>3.</strong> Subject: "Constituent Letter: Epstein Files &mdash; Demand for Action"</div>';
        h += '<a class="gl" href="'+esc(r.contact)+'" target="_blank">Open '+esc(r.name)+'\'s Contact Form</a>';
      } else {
        h += '<div class="lt-guide-s"><strong>2.</strong> Find '+esc(r.name)+'\'s contact form on their official website.</div>';
        h += '<div class="lt-guide-s"><strong>3.</strong> Paste the letter and use subject: "Constituent Letter: Epstein Files"</div>';
        h += '<a class="gl" href="https://www.house.gov/representatives/find-your-representative" target="_blank">Find Representative Contact</a>';
      }
      h += '</div>';
    }

    block.innerHTML = h;
    out.appendChild(block);
  });

  // Final note
  var note = document.createElement('div');
  note.className = 'lt-note';
  if(del==='us'){
    var email = document.getElementById('f-email').value.trim();
    note.innerHTML = recs.length+' letter'+(recs.length===1?'':'s')+' generated. We will print and mail '+(recs.length===1?'this':'all '+recs.length)+' for you at no charge.'+(email?' Confirmation to <strong>'+esc(email)+'</strong>.':'')+
    '<br><br>A handwritten signature carries weight. Print a copy for yourself and sign it too.<br><br>Every letter matters. The children are watching.';
  } else if(del==='email'){
    note.innerHTML = recs.length+' letter'+(recs.length===1?'':'s')+' generated. Use the "Copy & Open Contact Form" button above each letter to send it directly.'+
    '<br><br>Physical mail carries more weight than email. If you can print and mail, do. But any action is better than silence.<br><br>Every letter matters. The children are watching.';
  } else {
    note.innerHTML = recs.length+' letter'+(recs.length===1?'':'s')+' generated. Print '+(recs.length===1?'it':'each')+', <strong>sign by hand</strong>, and mail to the address on the letter.'+
    '<br><br>Congressional staff tallies constituent mail. A signed letter on paper arrives with weight. You are being counted.<br><br>Every letter matters. The children are watching.';
  }
  out.appendChild(note);
  out.classList.add('vis');
  out.scrollIntoView({behavior:'smooth',block:'start'});
}

function buildLetter(name,city,addr,date,rec,exp,feel,extra,dS,dP,dM,dR){
  var L = '';
  if(addr){L+=name+'\n'+addr+'\n\n'}else{L+=name+'\n\n'}
  L+=date+'\n\n';
  L+=rec.name+'\n'+rec.address+'\n\n';
  L+='Dear '+rec.name+',\n\n';
  L+='I am writing to you as a constituent'+(city?' in '+city:'')+' who has confronted the Epstein files \u2014 the three million pages of evidence documenting decades of child sex trafficking, institutional complicity, and an architecture of impunity that reaches into both political parties and the highest offices of government.\n\n';
  if(feel) L+=feel+'\n\n';
  if(exp) L+=exp+'\n\n';
  L+='Over a thousand children were fed into a machine built by Jeffrey Epstein and enabled by people who still hold power, influence, and public trust. Flight logs, sworn depositions, authenticated emails, and court records document what happened. The evidence is not ambiguous. And yet, the powerful who walked through those rooms, who flew on those planes, who smiled in those photographs \u2014 they remain free and unaccountable.\n\n';
  L+='I am writing to demand action:\n\n';
  var n=1;
  if(dS){L+=n+'. Remove the statute of limitations for all crimes against children \u2014 retroactively and in perpetuity. No child\u2019s suffering should expire on a legal clock. The trauma does not expire. The justice should not either.\n\n';n++}
  if(dP){L+=n+'. Pursue the impeachment and prosecution of all individuals incriminated in the Epstein files, regardless of party affiliation, office held, or personal wealth. The law must apply equally, or it is not law.\n\n';n++}
  if(dM){L+=n+'. Convene a public hearing on Capitol Hill with Ghislaine Maxwell providing full testimony under oath. She was convicted of sex trafficking minors. She knows the names. The American people deserve to hear them.\n\n';n++}
  if(dR){L+=n+'. Release all Epstein-related files to the public, unredacted and without further delay. Selective batching by a Justice Department whose own leadership appears in the files is not transparency \u2014 it is management.\n\n';n++}
  if(extra) L+=extra+'\n\n';
  L+='The waters are receding. What is being revealed is not new ground \u2014 it is the old ground, with its graves exposed. I am asking you to look down and not look away.\n\n';
  L+='History is watching. The children are watching. Your constituents are watching.\n\n';
  L+='Respectfully,\n\n\n'+name;
  if(city) L+='\n'+city;
  return L;
}

// ═══════════════════════════════════════════════════════════════
//  UTILITIES
// ═══════════════════════════════════════════════════════════════

function copyLt(btn){
  var block = btn.closest('.lt-hdr').parentElement;
  var body = block.querySelector('.lt-body');
  if(!body)return;
  navigator.clipboard.writeText(body.textContent).then(function(){
    btn.textContent='Copied';setTimeout(function(){btn.textContent='Copy'},2000);
  }).catch(function(){
    fallbackCopy(body.textContent);btn.textContent='Copied';setTimeout(function(){btn.textContent='Copy'},2000);
  });
}

function copyAndOpen(btn,url){
  var block = btn.closest('.lt-hdr').parentElement;
  var body = block.querySelector('.lt-body');
  if(!body)return;
  navigator.clipboard.writeText(body.textContent).then(function(){
    btn.textContent='Copied! Opening...';window.open(url,'_blank');
    setTimeout(function(){btn.textContent='Copy & Open Contact Form'},3000);
  }).catch(function(){
    fallbackCopy(body.textContent);window.open(url,'_blank');
    btn.textContent='Copied! Opening...';setTimeout(function(){btn.textContent='Copy & Open Contact Form'},3000);
  });
}

function fallbackCopy(text){
  var ta=document.createElement('textarea');ta.value=text;ta.style.cssText='position:fixed;left:-9999px';
  document.body.appendChild(ta);ta.select();
  try{document.execCommand('copy')}catch(e){}
  document.body.removeChild(ta);
}

function esc(s){var d=document.createElement('div');d.textContent=s;return d.innerHTML}
</script>
</body>
</html>
